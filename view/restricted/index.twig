{% extends "restricted/base.twig" %}

{% block content %}
    <!--Container-->
    <div class="container w-full mx-auto pt-20">

        <div class="w-full px-4 py-0 md:px-0 md:mt-8 mb-16 text-gray-200 leading-normal">

            <!--Console Content-->

            <div class="flex flex-wrap">
                <div class="w-full md:w-1/2 xl:w-1/3 p-3">
                    <!--Metric Card-->
                    <div class="bg-zinc-800 h-full rounded shadow p-2">
                        <div class="flex flex-row items-center">
                            <div class="flex-1 text-left md:text-left">
                                <h5 class="font-bold uppercase text-green-700">Banca atual</h5>
                                <h3 class="font-bold text-3xl">R$ {{bankroll}} <span class="align-top text-sm font-semibold text-white mt-10 px-1.5 bg-{{colorPercentBankrollYield}}-500 rounded-full">{{percentBankrollYield}}%</span></h3>
                            </div>
                        </div>
                        <div class="w-full">
                            <canvas id="chartjs-0" width="389" height="128"></canvas>
                        </div>
                    </div>
                    <!--/Metric Card-->
                </div>

                <div class="w-1/2 md:w-1/2 xl:w-1/3 p-3">
                    <!--Metric Card-->
                    <div class="bg-zinc-800 h-full rounded shadow p-2">
                        <div class="flex flex-row items-center">
                            <div class="flex-1 text-left md:text-left">
                                <h5 class="font-bold uppercase text-green-700">Lucro do dia</h5>
                                <h3 class="font-bold text-md md:text-3xl">R$ {{dailyYield}} 
                                {# <span class="text-{{colorDailyYield}}-500"><i class="fa-solid fa-{{narrowDailyYield}}"></i></span> #}
                                </h3>
                            </div>
                        </div>
                        <div class="w-full">
                            <canvas id="chartjs-1" width="389" height="128"></canvas>
                        </div>
                    </div>
                    <!--/Metric Card-->
                </div>

                <div class="w-1/2 md:w-1/2 xl:w-1/3 p-3">
                    <!--Metric Card-->
                    <div class="bg-zinc-800 h-full rounded shadow p-2">
                        <div class="flex flex-row items-center">
                            <div class="flex-1 text-left md:text-left">
                                <h5 class="font-bold uppercase text-green-700">Lucro total</h5>
                                <h3 class="font-bold text-md md:text-3xl">R$ {{accumulatedYield}} <span class="text-{{colorAccumulatedYield}}-500"><i class="fa-solid fa-{{narrowAccumulatedYield}}"></i></span></h3>
                            </div>
                        </div>
                        <div class="w-full">
                            <canvas id="chartjs-2" width="389" height="128"></canvas>
                        </div>
                    </div>
                    <!--/Metric Card-->
                </div>

                <!-- <div class="w-full md:w-1/2 xl:w-1/3 p-3"> -->
                    <!--Metric Card-->
                    <!-- <div class="bg-gray-200 border rounded shadow p-2">
                        <div class="flex flex-row items-center">
                            <div class="flex-shrink pr-4">
                                <div class="rounded p-3 bg-green-600"><i class="fa fa-wallet fa-2x fa-fw fa-inverse"></i></div>
                            </div>
                            <div class="flex-1 text-right md:text-center">
                                <h5 class="font-bold uppercase text-gray-500">Banca - inicial <a href="#"><span class="text-blue-600" data-bs-toggle="modal" data-bs-target="#balanceStartModal"><i class="fa-solid fa-rotate"></i></span></a></h5>
                                <h3 class="font-bold text-3xl">R$ 1047,00 <span class="text-red-500"><i class="fas fa-caret-down"></i></span></h3>
                            </div>
                        </div>
                    </div> -->
                    <!--/Metric Card-->
                <!-- </div>     -->
            </div>

            <div class="flex flex-wrap">
                <div class="w-1/2 md:w-1/4 p-3">
                    <!--Metric Card-->
                    <div class="bg-zinc-800 rounded shadow p-2 h-24 md:h-full">
                        <div class="flex flex-row items-center">
                            <div class="flex-shrink pr-4 hidden md:block">
                                <div class="rounded p-3 bg-green-600"><i class="fas fa-percent fa-2x fa-fw fa-inverse"></i></div>
                            </div>
                            <div class="flex-1 text-center md:text-center">
                                <h5 class="font-bold uppercase text-green-700">Margem de lucro</h5>
                                <h3 class="font-bold text-xl md:text-2xl">{{yield}}%</h3>
                                <div>&nbsp;</div>
                            </div>
                        </div>
                    </div>
                    <!--/Metric Card-->
                </div>

                <div class="w-1/2 md:w-1/4 p-3">
                    <!--Metric Card-->
                    <div class="bg-zinc-800 rounded shadow p-2 h-24 md:h-full">
                        <div class="flex flex-row items-center">
                            <div class="flex-shrink pr-4 hidden md:block">
                                <div class="rounded p-3 bg-blue-600"><i class="fas fa-tasks fa-2x fa-fw fa-inverse"></i></div>
                            </div>
                            <div class="flex-1 text-center md:text-center">
                                <h5 class="font-bold uppercase text-green-700">Meta do dia</h5>
                                <h3 class="font-bold text-xl md:text-2xl">R$ {{goal}}</h3>
                                <div class="relative w-full bg-red-500 rounded h-3 mt-2">
                                    <div style="width: {{percenteGoal}}%" class="absolute top-0 h-3 rounded shim-green text-[8px] font-bold text-left"></div>
                                </div>
                                <div class="w-1/2 float-right text-right text-[9px] font-bold text-red-600">
                                    {{(100-percenteGoal)}}%
                                </div>
                                <div class="w-1/2 text-left text-[9px] font-bold text-green-600">
                                    {{percenteGoal}}%
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--/Metric Card-->
                </div>

                <div class="w-1/2 md:w-1/4 p-3">
                    <!--Metric Card-->
                    <div class="bg-zinc-800 rounded shadow p-2 h-24 md:h-full">
                        <div class="flex flex-row items-center">
                            <div class="flex-shrink pr-4 hidden md:block">
                                <div class="rounded p-3 bg-red-600"><i class="fas fa-sack-xmark fa-2x fa-fw fa-inverse"></i></div>
                            </div>
                            <div class="flex-1 text-center md:text-center">
                                <h5 class="font-bold uppercase text-green-700">Stop Loss</h5>
                                <h3 class="font-bold text-xl md:text-2xl text-{% if bankroll <= stopLoss %}red-700{% else %}gray-200{% endif %}">R$ {{stopLoss}}</h3>
                                <div>&nbsp;</div>
                            </div>
                        </div>
                    </div>
                    <!--/Metric Card-->
                </div>

                <div class="w-1/2 md:w-1/4 p-3">
                    <!--Metric Card-->
                    <div class="bg-zinc-800 rounded shadow p-2 h-24 md:h-full">
                        <div class="flex flex-row items-center">
                            <div class="flex-shrink pr-4 hidden md:block">
                                <div class="rounded p-3 bg-green-600"><i class="fas fa-sack-dollar fa-2x fa-fw fa-inverse"></i></div>
                            </div>
                            <div class="flex-1 text-center md:text-center">
                                <h5 class="font-bold uppercase text-green-700">Stop Win</h5>
                                <h3 class="font-bold text-xl md:text-2xl text-{% if bankroll >= stopWin %}green-700{% else %}gray-200{% endif %}">R$ {{stopWin}}</h3>
                                <div>&nbsp;</div>
                            </div>
                        </div>
                    </div>
                    <!--/Metric Card-->
                </div>
                
            </div>

            <!--Divider-->
            <hr class="border-b-5 border-gray-100 my-8 mx-4">

            <div class="flex flex-row flex-wrap flex-grow mt-2">

                <div class="w-full md:w-1/2 p-3">
                    <!--Template Card-->
                    <div class="bg-zinc-800 rounded shadow">
                        <div class="bg-zinc-800 rounded p-3">
                            <h5 class="font-bold uppercase text-green-700">Gestão das Apostas{% if tableGales is not null %}¹{% endif %}</h5>
                        </div>
                        <div class="p-2">
                            <table class="w-full p-5 text-gray-200 text-center text-sm md:text-md">
                                <thead>
                                    <tr class="bg-zinc-700 text-gray-200">
                                        <th>Porcentagem</th>
                                        <th>Valor da aposta{% if tableGales is not null %}²{% endif %}</th>
                                        <th>Greens{% if tableGales is not null %}³{% endif %}</th>
                                    </tr>
                                </thead>

                                <tbody>
                                {% if tableGales is not null %}
                                    {% for gale in tableGales %}
                                    <tr class="{{gale.color}}">
                                        <td>{{gale.valuePercentage}}%</td>
                                        <td>R$ {{gale.gale}}</td>
                                        <td>{{gale.greensRequired}}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr >
                                        <td colspan="3" class="text-center">Configure a sua banca</td>
                                    </tr>
                                {% endif %}
                                </tbody>
                            </table>
                            {% if tableGales is not null %}
                                <div class="text-[10px] text-gray-500 mt-1">¹ Valores calculados com base no valor ncessário para bater a meta do dia.</div>
                                <div class="text-[10px] text-gray-500 mt-1">² Valores referentes ao primeiro <i>gale</i>. Siga o modelo <i>Martingale</i> nas próximas entradas.</div>
                                <div class="text-[10px] text-gray-500 mt-1">³ Quantidade aproximada de greens para bater a meta do dia. Considere a porcentagem do primeiro <i>gale</i>. Odd média de 2.00</div>
                            {% endif %}
                        </div>
                    </div>
                    <!--/Template Card-->
                </div>


                <div class="w-full md:w-1/2 p-3">
                    <!--Graph Card-->
                    <div class="bg-zinc-800 rounded shadow">
                        <div class="bg-zinc-800 rounded  p-3">
                            <h5 class="font-bold uppercase text-green-700">Saques</h5>
                        </div>
                        <div class="p-5">
                            <canvas id="chartjs-7" class="" width="undefined" height="75"></canvas>
                        </div>
                    </div>
                    <!--/Graph Card-->
                </div>



                <!-- <div class="w-full md:w-1/2 p-3"> -->
                    <!--Graph Card-->
                    <!-- <div class="bg-white border rounded shadow">
                        <div class="border-b p-3">
                            <h5 class="font-bold uppercase text-gray-600">Saques</h5>
                        </div>
                        <div class="p-5">
                            <canvas id="chartjs-0" class="chartjs" width="undefined" height="undefined"></canvas>
                            
                        </div>
                    </div> -->
                    <!--/Graph Card-->
                <!-- </div> -->


            </div>

            <!--/ Console Content-->

        </div>
    </div>
    <!--/container-->

    <!-- Modal -->
    {% include ('/restricted/inc/modal.twig') %}
    <!-- /Modal -->

    <!-- BannerAlert -->
    {% include ('/restricted/inc/bannerAlert.twig') %}
    <!-- /BannerAlert -->

{% endblock %}



{% block script %}
<script>
function deleteBanroll()
{
    if ( confirm("Realmente deseja excluir todas as operações vinculadas à esta banca?\n\nEsta operação não podera ser desfeita.") ){
        document.getElementById('deleteBankroll').submit();
    }
}
new Chart(document.getElementById("chartjs-0"), {
    "type": "line",
    "data": {
        "labels": [
            {% for chartBankroll in chart %}
                "{{chartBankroll.created_at|date("d/m/Y")}}",
            {% endfor %}
        ],
        "datasets": [{
            "label": "",
            "data": [
                {% for chartBankroll in chart %}
                    "{{chartBankroll.result}}",
                {% endfor %}
            ],
            "borderColor": "hsl(209, 100%, 42%)",
            "lineTension": 0.1,
            "fill": true,
            "backgroundColor": "hsl(206, 0%, 24%)",
            "borderWidth": 2,
            // "tension": 0,
            "pointRadius": 2,
            "pointHoverRadius": 3,
        }]
    },
    "options": {
        "scales": {
            "y": {
                "display": false,
                "beginAtZero": true,
            },
            "x": {
                "display": false,
            },
        },
        "plugins": {
            "legend": {
                "display": false,
            },
            "tooltip": {
                "callbacks": {
                // "title": () => true, // Disable tooltip title
                "label": (context) => (' R$ '+context.parsed.y),
                },
            },
        },
    }
});
</script>

<script>
new Chart(document.getElementById("chartjs-1"), {
    "type": "line",
    "data": {
        "labels": [
            {% for chartYieldByDay in chartYieldByDayData %}
                "{{chartYieldByDay.result_at|date("d/m/Y")}}",
            {% endfor %}
        ],
        "datasets": [{
            "label": "",
            "data": [
                {% for chartYieldByDay in chartYieldByDayData %}
                    "{{chartYieldByDay.result|number_format(2,'.','')}}",
                {% endfor %}
            ],
            "borderColor": "hsl(209, 100%, 42%)",
            "lineTension": 0.1,
            "fill": true,
            "backgroundColor": "hsl(206, 0%, 24%)",
            "borderWidth": 2,
            // "tension": 0,
            "pointRadius": 2,
            "pointHoverRadius": 3,
        }]
    },
    "options": {
        "scales": {
            "y": {
                "display": false,
                "beginAtZero": true,
            },
            "x": {
                "display": false,
            },
        },
        "plugins": {
            "legend": {
                "display": false,
            },
            "tooltip": {
                "callbacks": {
                // "title": () => true, // Disable tooltip title
                "label": (context) => (' R$ '+context.parsed.y),
                },
            },
        },
    }
});
</script>

<script>
new Chart(document.getElementById("chartjs-2"), {
    "type": "line",
    "data": {
        "labels": [
            {% for chartBankroll in chart %}
                "{{chartBankroll.created_at|date("d/m/Y")}}",
            {% endfor %}
        ],
        "datasets": [{
            "label": "",
            "data": [
                {% for chartBankroll in chart %}
                    "{{chartBankroll.operations|number_format(2,'.','')}}",
                {% endfor %}
            ],
            "borderColor": "hsl(209, 100%, 42%)",
            "lineTension": 0.1,
            "fill": true,
            "backgroundColor": "hsl(206, 0%, 24%)",
            "borderWidth": 2,
            "pointRadius": 2,
            "pointHoverRadius": 3,
        }]
    },
    "options": {
        "scales": {
            "y": {
                "display": false,
                "beginAtZero": true,
            },
            "x": {
                "display": false,
            },
        },
        "plugins": {
            "legend": {
                "display": false,
            },
            "tooltip": {
                "callbacks": {
                "label": (context) => (' R$ '+context.parsed.y),
                },
            },
        },
    }
});
</script>

<script>
new Chart(document.getElementById("chartjs-7"), {
    "type": "line",
    "data": {
        "labels": [
            {% for chartWithdrawals in chartWithdrawalsData %}
                "{{chartWithdrawals.withdrawal_at|date("d/m/Y")}}",
            {% endfor %}
        ],
        "datasets": [{
            "label": "",
            "data": [
                {% for chartWithdrawals in chartWithdrawalsData %}
                    "{{chartWithdrawals.result|number_format(2,'.','')}}",
                {% endfor %}
            ],
            "borderColor": "rgb(75, 192, 192)",
            "lineTension": 0.1,
            "fill": true,
            
        }]
    },
    "options": {
        "scales": {
            "y": {
                "display": false,
                "beginAtZero": true,
            },
            "x": {
                "display": true,
            },
        },
        "plugins": {
            "legend": {
                "display": false,
            },
            "tooltip": {
                "callbacks": {
                // "title": () => true, // Disable tooltip title
                "label": (context) => (' R$ '+context.parsed.y),
                },
            },
        },
    }
});
</script>

<script>
/*Toggle dropdown list*/
var userMenuDiv = document.getElementById("userMenu");
var userMenu = document.getElementById("userButton");

var navMenuDiv = document.getElementById("nav-content");
var navMenu = document.getElementById("nav-toggle");

document.onclick = check;

function check(e) {
    var target = (e && e.target) || (event && event.srcElement);

    //User Menu
    if (!checkParent(target, userMenuDiv)) {
        // click NOT on the menu
        if (checkParent(target, userMenu)) {
            // click on the link
            if (userMenuDiv.classList.contains("invisible")) {
                userMenuDiv.classList.remove("invisible");
            } else { userMenuDiv.classList.add("invisible"); }
        } else {
            // click both outside link and outside menu, hide menu
            userMenuDiv.classList.add("invisible");
        }
    }

    //Nav Menu
    if (!checkParent(target, navMenuDiv)) {
        // click NOT on the menu
        if (checkParent(target, navMenu)) {
            // click on the link
            if (navMenuDiv.classList.contains("hidden")) {
                navMenuDiv.classList.remove("hidden");
            } else { navMenuDiv.classList.add("hidden"); }
        } else {
            // click both outside link and outside menu, hide menu
            navMenuDiv.classList.add("hidden");
        }
    }

}

function checkParent(t, elm) {
    while (t.parentNode) {
        if (t == elm) { return true; }
        t = t.parentNode;
    }
    return false;
}
</script>
{% endblock %}